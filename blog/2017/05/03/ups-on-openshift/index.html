<!doctype html><html lang=en-us>
<head>
<title>UPS on OpenShift // {{ Damien }}</title>
<link rel="shortcut icon" href=/favicon.ico>
<meta charset=utf-8>
<meta name=generator content="Hugo 0.89.4">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=author content="Damien Murphy">
<meta name=description content>
<link rel=stylesheet href=https://damienomurchu.github.io/css/main.min.4a7ec8660f9a44b08c4da97c5f2e31b1192df1d4d0322e65c0dbbc6ecb1b863f.css>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="UPS on OpenShift">
<meta name=twitter:description content="Unified Push Server (UPS) on OpenShift Prerequisites You should have a locally installed version of OpenShift, or access to an OpenShift cluster. If you don&rsquo;t have either, you can set up your own OpenShift local cluster by reading this [document]({{ &ldquo;/hero-openshift&rdquo; | relative_url }}).
Bringing up your cluster Bring up your cluster with:
oc cluster up --public-hostname=127.0.0.1 --host-data-dir=$HOME/os/data-dir --host-config-dir=$HOME/os/config-dir
Log into your cluster Log into your cluster via oc login">
<meta property="og:title" content="UPS on OpenShift">
<meta property="og:description" content="Unified Push Server (UPS) on OpenShift Prerequisites You should have a locally installed version of OpenShift, or access to an OpenShift cluster. If you don&rsquo;t have either, you can set up your own OpenShift local cluster by reading this [document]({{ &ldquo;/hero-openshift&rdquo; | relative_url }}).
Bringing up your cluster Bring up your cluster with:
oc cluster up --public-hostname=127.0.0.1 --host-data-dir=$HOME/os/data-dir --host-config-dir=$HOME/os/config-dir
Log into your cluster Log into your cluster via oc login">
<meta property="og:type" content="article">
<meta property="og:url" content="https://damienomurchu.github.io/blog/2017/05/03/ups-on-openshift/"><meta property="article:section" content="published">
<meta property="article:published_time" content="2017-05-03T00:00:00+00:00">
<meta property="article:modified_time" content="2017-05-03T00:00:00+00:00">
</head>
<body>
<header class=app-header>
<a href=https://damienomurchu.github.io><img class=app-header-avatar src=/img/profile-2.jpg alt="Damien Murphy"></a>
<h1>{{ Damien }}</h1>
<nav class=app-header-menu>
<a class=app-header-menu-item href=/>Home</a>
~
<a class=app-header-menu-item href=/tags/>Tags</a>
~
<a class=app-header-menu-item href=/about/>About</a>
</nav>
<p>Software Engineer</p>
<div class=app-header-social>
<a href=https://twitter.com/tech_damo target=_blank rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter"><title>Twitter</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg>
</a>
<a href=https://github.com/damienomurchu target=_blank rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>Github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a>
<a href=https://www.linkedin.com/in/damienomurchu/ target=_blank rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-linkedin"><title>LinkedIn</title><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg>
</a>
</div>
</header>
<main class=app-container>
<article class=post>
<header class=post-header>
<h1 class=post-title>UPS on OpenShift</h1>
<div class=post-meta>
<div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
May 3, 2017
-<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
3 min read
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
<a class=tag href=https://damienomurchu.github.io/tags/openshift/>OpenShift</a>
<a class=tag href=https://damienomurchu.github.io/tags/ups/>UPS</a>
<a class=tag href=https://damienomurchu.github.io/tags/mobile/>Mobile</a>
</div>
</div>
</header>
<div class=post-content>
<h1 id=unified-push-server-ups-on-openshift>Unified Push Server (UPS) on OpenShift</h1>
<h2 id=prerequisites>Prerequisites</h2>
<p>You should have a locally installed version of OpenShift, or access to an OpenShift cluster. If you don&rsquo;t have either, you can set up your own OpenShift local cluster by reading this [document]({{ &ldquo;/hero-openshift&rdquo; | relative_url }}).</p>
<h2 id=bringing-up-your-cluster>Bringing up your cluster</h2>
<p>Bring up your cluster with:<br>
<code>oc cluster up --public-hostname=127.0.0.1 --host-data-dir=$HOME/os/data-dir --host-config-dir=$HOME/os/config-dir</code></p>
<p><img src=/assets/images/hero-ups/oc-cluster-up.png alt=oc-cluster-up></p>
<h2 id=log-into-your-cluster>Log into your cluster</h2>
<p>Log into your cluster via <code>oc login</code></p>
<p><img src=/assets/images/hero-ups/oc-login.png alt=oc-login></p>
<h2 id=deploy-mysql-containers>Deploy MySQL containers</h2>
<p>We will be using the UPS docker image from Docker Hub. This image requires that we have 2 MySQL instances named &lsquo;unifiedpush&rsquo; and &lsquo;keycloak&rsquo;. Create these by:</p>
<ul>
<li><code>oc new-app mysql MYSQL_USER=unifiedpush MYSQL_PASSWORD=unifiedpush MYSQL_DATABASE=keycloak --name=keycloak</code></li>
</ul>
<p><img src=/assets/images/hero-ups/deploy-mysql-keycloak.png alt=deploy-mysql-keycloak></p>
<ul>
<li><code>oc new-app mysql MYSQL_USER=unifiedpush MYSQL_PASSWORD=unifiedpush MYSQL_DATABASE=unifiedpush --name=unifiedpush</code></li>
</ul>
<p><img src=/assets/images/hero-ups/deploy-mysql-unified-push.png alt=deploy-mysql-unified-push></p>
<p>Confirm that both MySQL instances have come online by checking the OpenShift console, or via the terminal with <code>oc status</code>.</p>
<p><img src=/assets/images/hero-ups/pod-keycloak.png alt=pod-keycloak><br>
<img src=/assets/images/hero-ups/pod-unifiedpush.png alt=pod-unifiedpush></p>
<h2 id=deploy-aerogear-ups>Deploy AeroGear UPS</h2>
<p>With both required MySQL instances installed and running, UPS can now be deployed by running the following command in your terminal:</p>
<pre><code>oc new-app aerogear/unifiedpush-wildfly \ 
UNIFIEDPUSH_PORT_3306_TCP_ADDR=unifiedpush \ 
UNIFIEDPUSH_PORT_3306_TCP_PORT=3306 \ 
UNIFIEDPUSH_ENV_MYSQL_DATABASE=unifiedpush \ 
KEYCLOAK_PORT_3306_TCP_ADDR=keycloak \ 
KEYCLOAK_PORT_3306_TCP_PORT=3306 \ 
KEYCLOAK_ENV_MYSQL_DATABASE=keycloak \ 
UNIFIEDPUSH_ENV_MYSQL_USER=unifiedpush \ 
UNIFIEDPUSH_ENV_MYSQL_PASSWORD=unifiedpush \ 
KEYCLOAK_ENV_MYSQL_USER=unifiedpush \ 
KEYCLOAK_ENV_MYSQL_PASSWORD=unifiedpush \ 
--name=unifiedpush-wildfly  
</code></pre>
<p><img src=/assets/images/hero-ups/deploy-unifiedpush-wildfly.png alt=deploy-unifiedpush-wildfly><br>
<img src=/assets/images/hero-ups/pod-unifiedpush-wildfly.png alt=pod-unifiedpush-wildfly></p>
<p>This will deploy UPS and pass in the necessary environmental variables for UPS to pick up the MySQL instances. You can see these environmental variables in the OpenShift console:</p>
<p><img src=/assets/images/hero-ups/deploy-unifiedpush-wildfly-env-vars.png alt=deploy-unifiedpush-wildfly-env-vars></p>
<h2 id=exposing-routes-to-ups-deployment>Exposing routes to UPS deployment</h2>
<p>With UPS deployed, the final step is to expose route(s) so we can access our UPS instance through a web browser. The following creates 2 routes; one to access UPS through localhost on our web browser, and one through which the android emulator can access UPS:</p>
<ul>
<li><code>oc expose service unifiedpush-wildfly --hostname=ups.127.0.0.1.nip.io --port=8080-tcp --name=ups-local-unsecured</code></li>
<li><code>oc expose service unifiedpush-wildfly --hostname=ups.10.0.2.2.nip.io --port=8080-tcp --name=ups-android-unsecured</code></li>
</ul>
<p>You should see confirmation that the routes have been created:</p>
<p><img src=/assets/images/hero-ups/terminal-route-1.png alt=terminal-route-1><br>
<img src=/assets/images/hero-ups/terminal-route-2.png alt=terminal-route-2></p>
<p>The OpenShift console will confirm that this also:</p>
<p><img src=/assets/images/hero-ups/pod-unifiedpush-wildfly-routes-2.png alt=pod-unifiedpush-wildfly-routes-2><br>
<img src=/assets/images/hero-ups/pod-unifiedpush-wildfly-routes-1.png alt=pod-unifiedpush-wildfly-routes-1></p>
<p>** if you require any other routes to be exposed to UPS for your apps, you can simply add them in the above manner.</p>
<h2 id=fixing-keycloak-linking>Fixing Keycloak Linking</h2>
<p>UPS uses an embedded Keycloak server to handle its authentication. Right now there is an issue when the UPS pod starts up it can’t route to Keycloak using the public route. To work around this, do the following after the pod has loaded fully</p>
<ul>
<li>navigate to the unifiedpush-wildfly pod in the OpenShift web console</li>
</ul>
<p><img src=/assets/images/hero-ups/applications-pods.png alt=applications-pods></p>
<ul>
<li>Run <code>wget http://localhost:8080/ag-push/index.html</code> in the Terminal for the unifiedpush-wildfly pod</li>
</ul>
<p><img src=/assets/images/hero-ups/pod-unifiedpush-wildfly-terminal.png alt=pod-unifiedpush-wildfly-terminal></p>
<h2 id=configuring-ups>Configuring UPS</h2>
<p>UPS can now be configured via the browser and the route you have created:</p>
<p><img src=/assets/images/hero-ups/browser-ups.png alt=browser-ups></p>
<ul>
<li>Click on the &lsquo;Administration Console&rsquo; from the above WildFly landing page to bring you to the UPS front screen</li>
</ul>
<p><img src=/assets/images/hero-ups/ups-front-screen.png alt=ups-front-screen></p>
<p>** This tutorial does not cover how to configure UPS to send push notifications to your mobile app. For guidance on how to do so, the AeroGear HelloPush tutorial may be found <a href=https://github.com/aerogear/aerogear-android-cookbook/tree/master/HelloPush>here</a> which covers cover how to configure push notifications to an app with UPS.</p>
</div>
<div class=post-footer>
</div>
</article>
</main>
</body>
</html>